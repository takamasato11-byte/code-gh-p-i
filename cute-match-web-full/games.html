<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>ğŸ® TrÃ² ChÆ¡i & CÃ¢u Há»i - Cute Match</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/style.css">
</head>

<body>

<header>
  <span class="logo">ğŸ’˜ Cute Match</span>
  <nav>
    <a href="index.html">ğŸ  Trang Chá»§</a>
    <a href="account.html">ğŸ‘¤ TÃ i Khoáº£n</a>
    <a href="match.html">ğŸ”¥ Háº¹n HÃ²</a>
    <a href="feed.html">ğŸ“ Báº£ng Tin</a>
    <a href="chat.html">ğŸ’¬ TrÃ² Chuyá»‡n</a>
    <button id="darkModeToggle">ğŸŒ™</button>
  </nav>
</header>

<main class="container">
  <h1 class="text-center">ğŸ® TrÃ² ChÆ¡i & CÃ¢u Há»i</h1>

  <div class="feature-grid">
    <div class="feature-box" onclick="startQuiz('compatibility')">
      <div class="feature-icon">ğŸ§©</div>
      <h3>CÃ¢u Há»i TÆ°Æ¡ng ThÃ­ch</h3>
      <p>Kiá»ƒm tra Ä‘á»™ há»£p nhau</p>
    </div>

    <div class="feature-box" onclick="startQuiz('lovelanguage')">
      <div class="feature-icon">ğŸ’•</div>
      <h3>NgÃ´n Ngá»¯ TÃ¬nh YÃªu</h3>
      <p>KhÃ¡m phÃ¡ cÃ¡ch báº¡n yÃªu</p>
    </div>
  </div>

  <div id="gameContainer" class="card" style="display:none;margin-top:30px">
    <h2 id="gameTitle"></h2>

    <div id="questionContainer">
      <div class="progress-bar">
        <div class="progress-fill" id="quizProgress"></div>
      </div>

      <p>CÃ¢u <span id="currentQuestion"></span> / <span id="totalQuestions"></span></p>

      <h3 id="questionText"></h3>
      <div id="answersContainer"></div>

      <button class="btn full" id="nextBtn" onclick="nextQuestion()">CÃ¢u tiáº¿p â†’</button>
    </div>

    <div id="resultsContainer" style="display:none;text-align:center">
      <h2 id="resultScore"></h2>
      <h3 id="resultTitle"></h3>
      <p id="resultDescription"></p>

      <button class="btn" onclick="playAgain()">ğŸ”„ ChÆ¡i láº¡i</button>
      <button class="btn outline" onclick="closeGame()">â¬… Quay láº¡i</button>
    </div>
  </div>
</main>

<script src="js/main.js"></script>
<script>
const quizzes = {
  compatibility: {
    title: 'ğŸ§© CÃ¢u Há»i TÆ°Æ¡ng ThÃ­ch',
    icon: 'ğŸ§©',
    questions: [
      {
        text: 'Cuá»™c háº¹n lÃ½ tÆ°á»Ÿng cá»§a báº¡n?',
        answers: ['ğŸ½ï¸ Bá»¯a tá»‘i sang trá»ng', 'ğŸ  Háº¹n táº¡i nhÃ  áº¥m cÃºng', 'ğŸ”ï¸ PhiÃªu lÆ°u ngoÃ i trá»i', 'ğŸ¬ Xem phim táº¡i nhÃ '],
        points: [1, 2, 3, 4]
      },
      {
        text: 'CÃ¡ch báº¡n giáº£i quyáº¿t mÃ¢u thuáº«n?',
        answers: ['ğŸ’¬ NÃ³i chuyá»‡n má»Ÿ tÃ¢m', 'â³ Äá»£i tinh táº¡nh láº¡i', 'ğŸ¤ TÃ¬m thá»a hiá»‡p', 'ğŸ“ Viáº¿t láº¡i Ä‘á»ƒ suy ngáº«m'],
        points: [3, 2, 4, 1]
      },
      {
        text: 'Báº¡n mong muá»‘n Ä‘iá»u gÃ¬ nháº¥t trong má»‘i quan há»‡?',
        answers: ['ğŸ˜Š Sá»± vui váº» vÃ  cÆ°á»i', 'ğŸ’ª Sá»± há»— trá»£ vÃ  khÃ­ch lá»‡', 'â¤ï¸ TÃ¬nh cáº£m sÃ¢u sáº¯c', 'ğŸ¢ Nhá»¯ng Ä‘iá»u má»›i láº¡'],
        points: [2, 3, 4, 1]
      }
    ]
  },

  lovelanguage: {
    title: 'ğŸ’• NgÃ´n Ngá»¯ TÃ¬nh YÃªu',
    icon: 'ğŸ’•',
    questions: [
      {
        text: 'Báº¡n cáº£m tháº¥y Ä‘Æ°á»£c yÃªu nháº¥t khi?',
        answers: [
          'ğŸ’¬ Nghe lá»i ná»‹nh ná»c vÃ  lá»i tÃ¬nh tá»©',
          'ğŸ¤ ÄÆ°á»£c giÃºp Ä‘á»¡ vÃ  há»— trá»£',
          'ğŸ Nháº­n quÃ  táº·ng báº¥t ngá»',
          'ğŸ¤— ÄÆ°á»£c Ã´m hÃ´n vÃ  yÃªu chiá»u'
        ],
        points: [1, 2, 3, 4]
      },
      {
        text: 'Báº¡n thÃ­ch thá»ƒ hiá»‡n tÃ¬nh yÃªu nhÆ° tháº¿ nÃ o?',
        answers: [
          'ğŸ’¬ NÃ³i nhá»¯ng lá»i ngá»t ngÃ o',
          'ğŸ¤ GiÃºp Ä‘á»¡ vá»›i cÃ´ng viá»‡c',
          'ğŸ Mua quÃ  táº·ng',
          'ğŸ‘‹ Cháº¡m tay vÃ  Ã´m'
        ],
        points: [1, 2, 3, 4]
      },
      {
        text: 'Thá»i gian cháº¥t lÆ°á»£ng vá»›i báº¡n lÃ ?',
        answers: [
          'ğŸ’¬ NÃ³i chuyá»‡n sÃ¢u sáº¯c',
          'ğŸ§¹ LÃ m viá»‡c nhÃ  cÃ¹ng nhau',
          'ğŸ¬ CÃ¹ng xem phim hoáº·c chÆ¡i',
          'ğŸ¤— Ngá»“i cáº¡nh nhau gáº§n gÅ©i'
        ],
        points: [1, 2, 3, 4]
      }
    ]
  }
};

let currentQuizKey = '';
let currentQuiz;
let currentQuestion = 0;
let score = 0;
let answers = [];

function startQuiz(key) {
  // Check if logged in
  const user = AuthManager.getCurrentUser();
  if (!user) {
    showNotification('Vui lÃ²ng Ä‘Äƒng nháº­p Ä‘á»ƒ chÆ¡i trÃ² chÆ¡i', 'error');
    return;
  }
  
  currentQuizKey = key;
  currentQuiz = quizzes[key];
  currentQuestion = 0;
  score = 0;
  answers = [];

  document.getElementById('gameTitle').textContent = currentQuiz.title;
  document.getElementById('totalQuestions').textContent = currentQuiz.questions.length;
  document.getElementById('gameContainer').style.display = 'block';
  document.getElementById('resultsContainer').style.display = 'none';
  document.getElementById('questionContainer').style.display = 'block';

  showQuestion();
}

function showQuestion() {
  const q = currentQuiz.questions[currentQuestion];
  document.getElementById('questionText').textContent = q.text;
  document.getElementById('currentQuestion').textContent = currentQuestion + 1;

  document.getElementById('answersContainer').innerHTML =
    q.answers.map((a,i)=>`
      <label>
        <input type="radio" name="answer" value="${i}" onchange="selectAnswer(${i})">
        ${a}
      </label><br>
    `).join('');

  document.getElementById('quizProgress').style.width =
    ((currentQuestion+1)/currentQuiz.questions.length*100)+'%';
}

function selectAnswer(answerIndex) {
  const selected = document.querySelector('input[name="answer"]:checked');
  if (selected) {
    // Answer selected, enable next button (or just let user click)
    console.log('Answer selected:', answerIndex);
  }
}

function nextQuestion() {
  const selected = document.querySelector('input[name="answer"]:checked');
  if(!selected) {
    showNotification('Vui lÃ²ng chá»n má»™t cÃ¢u tráº£ lá»i!', 'error');
    return;
  }

  const answerIndex = parseInt(selected.value);
  const points = currentQuiz.questions[currentQuestion].points[answerIndex];
  score += points;
  answers.push(answerIndex);
  
  currentQuestion++;

  if(currentQuestion < currentQuiz.questions.length) {
    showQuestion();
  } else {
    showResults();
  }
}

function showResults() {
  document.getElementById('questionContainer').style.display = 'none';
  document.getElementById('resultsContainer').style.display = 'block';

  const maxScore = currentQuiz.questions.reduce((sum, q) => sum + Math.max(...q.points), 0);
  const percent = Math.round(score / maxScore * 100);

  document.getElementById('resultScore').textContent = percent + '%';

  let resultTitle, resultDescription, emoji;
  
  if(percent >= 80){
    resultTitle = 'ğŸ”¥ Ráº¥t Há»£p!';
    resultDescription = 'Hai báº¡n cá»±c ká»³ tÆ°Æ¡ng thÃ­ch! Äiá»u nÃ y ráº¥t tá»‘t!';
    emoji = 'ğŸ”¥';
  } else if(percent >= 60){
    resultTitle = 'ğŸ’• KhÃ¡ Há»£p!';
    resultDescription = 'CÃ³ tiá»m nÄƒng phÃ¡t triá»ƒn tá»‘t Ä‘áº¹p!';
    emoji = 'ğŸ’•';
  } else {
    resultTitle = 'â­ KhÃ¡c Biá»‡t!';
    resultDescription = 'Má»™t tráº£i nghiá»‡m thÃº vá»‹ vÃ  Ä‘á»™c Ä‘Ã¡o!';
    emoji = 'â­';
  }

  document.getElementById('resultTitle').textContent = resultTitle;
  document.getElementById('resultDescription').textContent = resultDescription;

  // Save score
  const results = JSON.parse(localStorage.getItem('gameResults') || '{}');
  if (!results[currentQuizKey]) results[currentQuizKey] = [];
  results[currentQuizKey].push({
    score: percent,
    date: new Date().getTime()
  });
  localStorage.setItem('gameResults', JSON.stringify(results));

  showNotification(`${emoji} Káº¿t quáº£: ${percent}%! ${resultDescription}`, 'success');
}

function playAgain() {
  startQuiz(currentQuizKey);
}

function shareResults() {
  const percent = document.getElementById('resultScore').textContent;
  const text = `TÃ´i vá»«a Ä‘áº¡t ${percent} trong trÃ² chÆ¡i ${currentQuiz.title} trÃªn Cute Match! ğŸ®â¤ï¸`;
  
  if (navigator.share) {
    navigator.share({
      title: 'Cute Match Game Results',
      text: text
    }).catch(err => console.log('Error sharing:', err));
  } else {
    showNotification('Káº¿t quáº£ Ä‘Ã£ Ä‘Æ°á»£c chia sáº»! ğŸ‰', 'success');
  }
}

function closeGame() {
  document.getElementById('gameContainer').style.display = 'none';
  document.getElementById('resultsContainer').style.display = 'none';
}
</script>

</body>
</html>
